贝叶斯滤波的核心思想是根据已知的观测数据和模型，通过递归更新系统状态的后验分布。

---

### 1. 状态估计的贝叶斯推断

假设我们的系统的状态可以通过一组离散的状态 $x_t$ 来描述，状态空间为 $\mathcal{X}$。贝叶斯滤波的目标是估计给定当前及过去的所有观测数据 $z_{1:t} = \{z_1, z_2, \dots, z_t\}$ 时，系统状态的后验分布$p(x_t \mid z_{1:t})$

#### **递推过程**

贝叶斯滤波的递推步骤由两部分组成：**预测**和**校正**。

---

### 2. 预测步骤（Prediction Step）

在**预测步骤**中，我们根据上一时刻的后验分布以及运动模型，推算当前时刻的状态分布。具体公式为：

$$
					p(x_t \mid z_{1:t-1}) = \int_{\mathcal{X}} p(x_t \mid x_{t-1}) p(x_{t-1} \mid z_{1:t-1}) \, dx_{t-1}
$$

- $p(x_t \mid x_{t-1})$ 是**状态转移模型**（或运动模型），表示从时刻 $t-1$ 到时刻 t 的状态变化概率。
    
- $p(x_{t-1} \mid z_{1:t-1})$ 是**先前的后验分布**，表示给定观测数据直到时刻 t−1t-1 的状态估计。
    

这个步骤通过**先验分布** $p(x_t \mid z_{1:t-1})$ 来表示当前时刻的状态预测，它是基于上一时刻的估计结果和系统动态模型来“预测”下一时刻可能的状态。

---

### 3. 校正步骤（Correction Step）

在**校正步骤**中，我们通过当前时刻的观测数据 ztz_t，来更新预测的状态分布。根据贝叶斯定理，更新后的状态后验分布 $p(x_t \mid z_{1:t})$ 可以通过以下公式计算：

$$
p(x_t \mid z_{1:t}) = \frac{p(z_t \mid x_t) p(x_t \mid z_{1:t-1})}{p(z_t \mid z_{1:t-1})}
$$

- $p(z_t \mid x_t)$ 是**观测模型**（或传感器模型），表示在状态 $x_t$ 下，观测值 $z_t$ 的条件概率（通常称为**似然函数**）。
    
- $p(x_t \mid z_{1:t-1})$ 是**预测分布**，即从预测步骤得到的当前时刻的先验分布。
    
- $p(z_t \mid z_{1:t-1}) = \int_{\mathcal{X}} p(z_t \mid x_t) p(x_t \mid z_{1:t-1}) \, dx_t$ 是**观测的归一化常数**（或边际似然），它确保后验分布的概率总和为 1。
    

校正步骤的核心在于，基于当前观测值 ztz_t，用似然函数对预测的分布进行加权，从而得到一个更新后的后验分布$p(x_t \mid z_{1:t})$。

---

### 4. 贝叶斯滤波的递归过程

贝叶斯滤波的核心是一个递归过程，结合了每一步的**预测**和**校正**。它的完整递推形式如下：

1. **预测步骤**：
    
$$
    p(x_t \mid z_{1:t-1}) = \int_{\mathcal{X}} p(x_t \mid x_{t-1}) p(x_{t-1} \mid z_{1:t-1}) \, dx_{t-1}
$$
2. **校正步骤**：
    
$$
    p(x_t \mid z_{1:t}) = \frac{p(z_t \mid x_t) p(x_t \mid z_{1:t-1})}{p(z_t \mid z_{1:t-1})}
$$

每次在新的观测 $z_t$ 到来时，通过预测步骤得到预测分布，再通过校正步骤利用当前观测进行更新。这个过程不断递归，最终得到对系统状态的最优估计。

---

### 5. 总结

贝叶斯滤波的核心数学形式是通过状态转移模型和观测模型，在每个时刻通过递归地**预测**和**校正**状态分布，从而获得对系统状态的最优后验估计。这个过程具有以下优点：

- **递归性**：每次只依赖上一时刻的状态和观测，不需要存储所有历史数据。
    
- **灵活性**：无论系统是线性还是非线性，观测是高斯分布还是任意分布，都可以通过贝叶斯滤波框架进行处理。
    
- **最优性**：在给定的模型和观测情况下，贝叶斯滤波提供了状态估计的**最大后验估计**（MAP）。


---


其实就是根据先验分布和状态转移矩阵计算下一个状态的概率分布，比如给一个给定状态的机器人，先给它一个指令：
- **运动模型**：当机器人收到“向右移动 1 格”的指令后，若它当前在格子 ：
    
    - 以 **80% 的概率** 成功移动到格子 $i+1$。
        
    - 以 **20% 的概率** 因为打滑或障碍维持在原地。  
        对于边界格（格子 1 或 5），任何“超出边界”的移动都会被视为留在该边界格。


就能计算下一个状态的概率分布。然后再根据观测模型计算其加权分布：

比如观测到机器人在某个位置 $j$ ，它真的在 $j$ 的概率是0.7 ，不在 $j$ 的概率是0.1。然后计算加权概率分布，也就是后验概率。



------
# kalman滤波
---

## 一、问题描述与模型假设

1. **状态空间模型**
    
    - **状态方程（过程模型）**
        
$$
       \mathbf{x}_{k} = \mathbf{F}_{k}\,\mathbf{x}_{k-1} + \mathbf{B}_{k}\,\mathbf{u}_{k} + \mathbf{w}_{k},
$$
        
        其中
        
        - ${x}_{k}\in\mathbb{R}^n$：系统在时刻 kk 的隐含状态向量；
            
        - ${F}_{k}\in\mathbb{R}^{n\times n}$：状态转移矩阵；
            
        - ${u}_{k}\in\mathbb{R}^l$：已知控制输入；
            
        - ${B}_{k}\in\mathbb{R}^{n\times l}$：控制输入矩阵；
            
        - ${w}_{k}\sim\mathcal{N}(\mathbf{0},\,\mathbf{Q}_{k})$：过程噪声，零均值、高斯，协方差  ${Q}_{k}$。
            
    - **观测方程（测量模型）**
        
$$
        _{k} = \mathbf{H}_{k}\,\mathbf{x}_{k} + \mathbf{v}_{k},
$$
        
        其中
        
        - ${z}_{k}\in\mathbb{R}^m$：时刻 kk 的观测向量；
            
        - ${H}_{k}\in\mathbb{R}^{m\times n}$：观测矩阵；
            
        - ${v}_{k}\sim\mathcal{N}(\mathbf{0},\,\mathbf{R}_{k})$：观测噪声，零均值、高斯，协方差 ${R}_{k}$。
            
2. **核心假设**
    
    - 过程噪声 ${\{w}_k\}$ 与观测噪声 $\{\mathbf{v}_k\}$ 均为白噪声、互不相关。
        
    - 初始状态 ${x}_0$ 具有已知先验分布 $\mathcal{N}(\hat{\mathbf{x}}_0,\;\mathbf{P}_0)$。
        

---

## 二、算法流程

卡尔曼滤波器在每一时刻 kk 包括 **两大步骤**：**预测（Predict）** 和 **更新（Update）**。

### 1. 预测步骤（Time Update）

利用过程模型，对当前状态及协方差进行预测：

- **状态预测**
    
$$
    \hat{\mathbf{x}}_{k|k-1} = \mathbf{F}_{k}\,\hat{\mathbf{x}}_{k-1|k-1} + \mathbf{B}_{k}\,\mathbf{u}_{k}.
$$
- **协方差预测**
    
$$
    {P}_{k|k-1} = \mathbf{F}_{k}\,\mathbf{P}_{k-1|k-1}\,\mathbf{F}_{k}^\top + \mathbf{Q}_{k}.
$$

其中，$\hat{\mathbf{x}}_{k|k-1}$ 表示在时刻 kk、给定 $k-1$ 时刻测量后的状态预测，$\mathbf{P}_{k|k-1}$ 为相应的预测误差协方差。

### 2. 更新步骤（Measurement Update）

利用新观测 $\mathbf{z}_{k}$，修正预测值，计算卡尔曼增益并更新状态与协方差：

1. **计算卡尔曼增益**
    
$$
    \mathbf{K}_{k} = \mathbf{P}_{k|k-1}\,\mathbf{H}_{k}^\top \bigl(\mathbf{H}_{k}\,\mathbf{P}_{k|k-1}\,\mathbf{H}_{k}^\top + \mathbf{R}_{k}\bigr)^{-1}.
$$
2. **状态更新（后验估计）**
    
$$
     \hat{\mathbf{x}}_{k|k} = \hat{\mathbf{x}}_{k|k-1} + \mathbf{K}_{k}\bigl(\mathbf{z}_{k} - \mathbf{H}_{k}\,\hat{\mathbf{x}}_{k|k-1}\bigr).
$$
3. **协方差更新**
    
$$
    \mathbf{P}_{k|k} = (\mathbf{I} - \mathbf{K}_{k}\,\mathbf{H}_{k})\,\mathbf{P}_{k|k-1}.
$$
    
    有时也写成
    
$$
   \mathbf{P}_{k|k} = \mathbf{P}_{k|k-1} - \mathbf{K}_{k}\,\mathbf{H}_{k}\,\mathbf{P}_{k|k-1}.
$$

---

## 三、增益推导（最小化均方误差）

卡尔曼增益 ${K}_k$ 的推导基于如下目标：选择 ${K}_k$ 使得后验估计误差协方差 ${P}_{k|k}$ 的迹最小，即

$$
 \mathbf{K}_{k} = \arg\min_{\mathbf{K}} \mathrm{trace}\bigl[ (\mathbf{I}-\mathbf{K}\mathbf{H}_k)\,\mathbf{P}_{k|k-1}\,(\mathbf{I}-\mathbf{K}\mathbf{H}_k)^\top + \mathbf{K}\,\mathbf{R}_k\,\mathbf{K}^\top \bigr].
$$

求导并令其为零，可得上文所示的最优增益公式。

---

## 四、性质与扩展

1. **最小方差估计**：在系统和噪声均为线性、高斯的条件下，KF 给出状态的最优线性无偏估计。
    
2. **鲁棒性**：对噪声统计特性$（Q,\mathbf{R}）$的选择敏感，需经验或自适应方法调整。
    
3. **扩展卡尔曼滤波（EKF）**：当系统或测量模型非线性时，可对其在当前估计点线性化，再使用 KF 步骤。
    
4. **无迹卡尔曼滤波（UKF）**：通过无迹变换（sigma 点）更准确地处理非线性，避免一阶线性化误差。
    

---



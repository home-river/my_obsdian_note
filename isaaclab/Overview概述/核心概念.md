
# Task Design Workflows（任务设计工作流程）

以下类是 Cartpole 环境配置类的一部分。 `RewardsCfg` 类定义了构成奖励函数的各个项。每个奖励项由其函数实现、权重和要传递给函数的附加参数定义。用户可以定义多个奖励项及其权重，以用于奖励函数。

```python
@configclass
class RewardsCfg:
    """MDP 的奖励配置类，定义多项奖励/惩罚条目。"""

    # (1) 存活奖励：只要 agent 处于存活状态，每步获得 +1.0
    alive = RewTerm(
        func=mdp.is_alive,   # 判定是否存活，返回 1 或 0
        weight=1.0           # 权重 +1.0
    )

    # (2) 终止惩罚：一旦进入终止/失败状态，给予 -2.0 惩罚
    terminating = RewTerm(
        func=mdp.is_terminated,  # 判定是否终止，返回 1 或 0
        weight=-2.0              # 权重 -2.0
    )

    # (3) 主任务：保持杆子直立
    pole_pos = RewTerm(
        func=mdp.joint_pos_target_l2,  # 计算关节位置与目标的 L2 距离
        weight=-1.0,                   # 距离越大，惩罚越多
        params={
            # 指定场景实体及关节名称
            "asset_cfg": SceneEntityCfg(
                "robot",
                joint_names=["cart_to_pole"]  # 小车-杆子连接处转轴
            ),
            "target": 0.0  # 目标位置（0 弧度，完全垂直）
        },
    )

    # (4) 形状奖励：减小小车速度以平滑运动
    cart_vel = RewTerm(
        func=mdp.joint_vel_l1,  # 计算关节速度的 L1 范数（绝对值和）
        weight=-0.01,          # 权重较小，次要惩罚
        params={
            "asset_cfg": SceneEntityCfg(
                "robot",
                joint_names=["slider_to_cart"]  # 滑轨到小车的移动关节
            )
        },
    )

    # (5) 形状奖励：减缓杆子摆动速度
    pole_vel = RewTerm(
        func=mdp.joint_vel_l1,  # 同样使用 L1 速度惩罚
        weight=-0.005,         # 权重更小，辅助作用
        params={
            "asset_cfg": SceneEntityCfg(
                "robot",
                joint_names=["cart_to_pole"]  # 杆子旋转关节
            )
        },
    )

```

解读：

```python
@configclass
class RewardsCfg:
    """Reward terms for the MDP."""
```

- `@configclass`  
    这是一个装饰器，用来标记这是一个“配置类”（configuration class）。通常配合某个配置系统使用，能够自动地把类里的属性当作可调参数加载或保存。
    
- `class RewardsCfg:`  
    定义了一个奖励配置类 `RewardsCfg`，用于描述在这个马尔可夫决策过程（MDP）里，各种奖励项（reward term）应该如何计算和加权。
    

---

***(1) Constant running reward

```python
alive = RewTerm(func=mdp.is_alive, weight=1.0)
```

- **`alive`**：名称
    
- **`RewTerm`**：表示一个奖励项（Reward Term）的构造器
    
    - `func=mdp.is_alive`：调用环境（MDP）接口 `is_alive(state)`，如果“还存活”（未失败）则返回 1，否则为 0
        
    - `weight=1.0`：这个项的权重为 +1.0
        
- **作用**：只要保持存活，就持续获得 +1 的奖励，鼓励 agent 尽量长时间不触发终止条件。
    

---

 ***(2) Failure penalty

```python
terminating = RewTerm(func=mdp.is_terminated, weight=-2.0)
```

- **`terminating`**：名称
    
- `func=mdp.is_terminated`：调用环境接口 `is_terminated(state)`，若进入失败/终止状态返回 1，否则 0
    
- `weight=-2.0`：权重 -2
    
- **作用**：一旦失败（如倒立摆倒下、越界等），立即付出 -2 的惩罚，降低 agent 盲目追求生存时忽略主要目标的可能性。
    

---

***(3) Primary task: keep pole upright

```python
pole_pos = RewTerm(
    func=mdp.joint_pos_target_l2,
    weight=-1.0,
    params={
        "asset_cfg": SceneEntityCfg("robot", joint_names=["cart_to_pole"]),
        "target": 0.0
    },
)
```

- **`pole_pos`**：名称
    
- `func=mdp.joint_pos_target_l2`：计算某一关节当前位置与指定目标位置的 L2（欧氏）距离（或平方距离）
    
- `weight=-1.0`：前面有负号，表示距离越大，惩罚越多
    
- `params`：额外参数
    
    - `"asset_cfg": SceneEntityCfg("robot", joint_names=["cart_to_pole"])`  
        指定要测量的关节属于哪个实体——这里是“robot” 中名为 `cart_to_pole` 的关节（即小车和杆子的转动轴）
        
    - `"target": 0.0`：目标位置为 0（竖直直立的角度为零偏差）
        
- **作用**：鼓励杆子保持竖直。杆子偏离竖直越多，就会被扣更多分。
    

---

 ***(4) Shaping tasks: lower cart velocity

```python
cart_vel = RewTerm(
    func=mdp.joint_vel_l1,
    weight=-0.01,
    params={"asset_cfg": SceneEntityCfg("robot", joint_names=["slider_to_cart"])}
)
```

- **`cart_vel`**：名称
    
- `func=mdp.joint_vel_l1`：计算所选关节速度的 L1（绝对值）范数
    
- `weight=-0.01`：小幅度惩罚速度，权重较小
    
- `params`：
    
    - `"asset_cfg": SceneEntityCfg("robot", joint_names=["slider_to_cart"])`  
        指定“slider_to_cart”关节，即小车在轨道上的移动关节
        
- **作用**：抑制小车来回剧烈移动，促进更平稳的控制。
    

---

***(5) Shaping tasks: lower pole angular velocity

```python
pole_vel = RewTerm(
    func=mdp.joint_vel_l1,
    weight=-0.005,
    params={"asset_cfg": SceneEntityCfg("robot", joint_names=["cart_to_pole"])}
)
```

- **`pole_vel`**：名称
    
- 与上面类似，也是对杆子关节速度做 L1 惩罚
    
- `weight=-0.005`：惩罚更小，次要的形状奖励（shaping）
    
- **作用**：减缓杆子的摆动速度，辅助主目标（保持杆子不翻倒）。
    

---

 ***整体思路

1. **存活奖励**（alive）+1/步
    
2. **失败惩罚**（terminating）-2 一次性
    
3. **主目标**（pole_pos）最小化杆偏离
    
4. **辅助目标**（cart_vel & pole_vel）分别平滑小车运动和减缓杆子摆动
    

这种将主任务和若干“奖励塑形”项（shaping terms）结合的设计，既能让 agent 明确知道“成功”的标准（杆子直立），又能避免学到一些不希望它去做的动作（高速来回乱跑、杆子剧烈摆动）。

---
